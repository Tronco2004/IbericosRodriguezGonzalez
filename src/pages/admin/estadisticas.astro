---
import Layout from '../../layouts/Layout.astro';
import { obtenerUsuarioDelToken } from '../../lib/auth';

const token = Astro.cookies.get('auth_token')?.value;
const usuario = token ? obtenerUsuarioDelToken(token) : null;

if (!usuario || usuario.rol !== 'admin') {
  return Astro.redirect('/sin-acceso');
}
---

<Layout>
  <div style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
    <div style="margin-bottom: 2rem;">
      <a href="/admin/dashboard" style="color: #a89968; text-decoration: none; font-weight: 600;">← Volver al Panel</a>
    </div>

    <h1 style="color: #001a33; font-size: 2rem; margin-bottom: 2rem;">Estadísticas</h1>

    <!-- Gráficos de Rendimiento -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
      <!-- Ventas por Mes -->
      <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
        <h3 style="color: #001a33; font-size: 1.1rem; margin: 0 0 1.5rem 0;">Ventas Este Mes</h3>
        <div style="text-align: center;">
          <div style="font-size: 2.5rem; color: #a89968; font-weight: 700; margin-bottom: 0.5rem;">€2,550</div>
          <p style="color: #666; margin: 0; font-size: 0.9rem;">↑ 12% respecto a mes anterior</p>
        </div>
      </div>

      <!-- Nuevos Clientes -->
      <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
        <h3 style="color: #001a33; font-size: 1.1rem; margin: 0 0 1.5rem 0;">Nuevos Clientes</h3>
        <div style="text-align: center;">
          <div style="font-size: 2.5rem; color: #001a33; font-weight: 700; margin-bottom: 0.5rem;">8</div>
          <p style="color: #666; margin: 0; font-size: 0.9rem;">↑ 4 más que el mes pasado</p>
        </div>
      </div>

      <!-- Pedidos Completados -->
      <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);">
        <h3 style="color: #001a33; font-size: 1.1rem; margin: 0 0 1.5rem 0;">Pedidos Completados</h3>
        <div style="text-align: center;">
          <div style="font-size: 2.5rem; color: #2e7d32; font-weight: 700; margin-bottom: 0.5rem;">24</div>
          <p style="color: #666; margin: 0; font-size: 0.9rem;">89% tasa de éxito</p>
        </div>
      </div>
    </div>

    <!-- Tabla de Productos más Vendidos -->
    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); margin-bottom: 2rem;">
      <h3 style="color: #001a33; font-size: 1.3rem; margin: 0 0 1.5rem 0;">Top 5 Productos Más Vendidos</h3>
      
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: #f5f5f5; border-bottom: 2px solid #ddd;">
            <th style="padding: 1rem; text-align: left; color: #001a33; font-weight: 700;">Producto</th>
            <th style="padding: 1rem; text-align: center; color: #001a33; font-weight: 700;">Ventas</th>
            <th style="padding: 1rem; text-align: center; color: #001a33; font-weight: 700;">Ingresos</th>
            <th style="padding: 1rem; text-align: center; color: #001a33; font-weight: 700;">Evolución</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 1rem; color: #001a33; font-weight: 600;">Jamón Ibérico Reserva</td>
            <td style="padding: 1rem; text-align: center; color: #666;">12</td>
            <td style="padding: 1rem; text-align: center; color: #a89968; font-weight: 700;">€1,199.88</td>
            <td style="padding: 1rem; text-align: center; color: #2e7d32; font-weight: 600;">↑ 15%</td>
          </tr>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 1rem; color: #001a33; font-weight: 600;">Queso Manchego Premium</td>
            <td style="padding: 1rem; text-align: center; color: #666;">8</td>
            <td style="padding: 1rem; text-align: center; color: #a89968; font-weight: 700;">€176.00</td>
            <td style="padding: 1rem; text-align: center; color: #2e7d32; font-weight: 600;">↑ 8%</td>
          </tr>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 1rem; color: #001a33; font-weight: 600;">Chorizo de Bellota</td>
            <td style="padding: 1rem; text-align: center; color: #666;">5</td>
            <td style="padding: 1rem; text-align: center; color: #a89968; font-weight: 700;">€90.00</td>
            <td style="padding: 1rem; text-align: center; color: #2e7d32; font-weight: 600;">↑ 3%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</Layout>
