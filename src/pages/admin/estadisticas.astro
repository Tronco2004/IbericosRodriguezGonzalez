---
import Layout from '../../layouts/Layout.astro';
import { obtenerUsuarioDelToken } from '../../lib/auth';

const token = Astro.cookies.get('auth_token')?.value;
const usuario = token ? obtenerUsuarioDelToken(token) : null;

if (!usuario || usuario.rol !== 'admin') {
  return Astro.redirect('/sin-acceso');
}
---

<Layout>
  <div class="admin-page">
    <div class="admin-container">
      <header class="admin-header">
        <a href="/admin/dashboard" class="admin-back-btn">← Volver al Panel</a>
        <h1 class="admin-title">Estadísticas</h1>
      </header>

      <!-- Tarjetas de Estadísticas -->
      <div class="admin-cards-grid stats-grid">
        <!-- Ventas por Mes -->
        <div class="admin-card stats-card">
          <h3 class="stats-card-title">Ventas Este Mes</h3>
          <div class="stats-card-content">
            <div class="stats-value stats-value-primary">€2,550</div>
            <p class="stats-trend">↑ 12% respecto a mes anterior</p>
          </div>
        </div>

        <!-- Nuevos Clientes -->
        <div class="admin-card stats-card">
          <h3 class="stats-card-title">Nuevos Clientes</h3>
          <div class="stats-card-content">
            <div class="stats-value stats-value-secondary">8</div>
            <p class="stats-trend">↑ 4 más que el mes pasado</p>
          </div>
        </div>

        <!-- Pedidos Completados -->
        <div class="admin-card stats-card">
          <h3 class="stats-card-title">Pedidos Completados</h3>
          <div class="stats-card-content">
            <div class="stats-value stats-value-success">24</div>
            <p class="stats-trend">89% tasa de éxito</p>
          </div>
        </div>
      </div>

      <!-- Tabla de Productos más Vendidos -->
      <div class="admin-card stats-table-card">
        <h3 class="stats-section-title">Top 5 Productos Más Vendidos</h3>
        
        <table class="stats-table">
          <thead>
            <tr>
              <th class="text-left">Producto</th>
              <th class="text-center">Ventas</th>
              <th class="text-center">Ingresos</th>
              <th class="text-center">Evolución</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="stats-product-name">Jamón Ibérico Reserva</td>
              <td class="text-center stats-sales">12</td>
              <td class="text-center stats-revenue">€1,199.88</td>
              <td class="text-center stats-evolution-up">↑ 15%</td>
            </tr>
            <tr>
              <td class="stats-product-name">Queso Manchego Premium</td>
              <td class="text-center stats-sales">8</td>
              <td class="text-center stats-revenue">€176.00</td>
              <td class="text-center stats-evolution-up">↑ 8%</td>
            </tr>
            <tr>
              <td class="stats-product-name">Chorizo de Bellota</td>
              <td class="text-center stats-sales">5</td>
              <td class="text-center stats-revenue">€90.00</td>
              <td class="text-center stats-evolution-up">↑ 3%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</Layout>

<style is:global>
  /* Grid específico para estadísticas */
  .stats-grid {
    margin-bottom: 3rem;
  }

  /* Tarjetas de estadísticas */
  .stats-card {
    text-align: center;
  }

  .stats-card-title {
    color: #001a33;
    font-size: 1.1rem;
    margin: 0 0 1.5rem 0;
    font-weight: 600;
  }

  .stats-card-content {
    text-align: center;
  }

  .stats-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .stats-value-primary {
    color: #a89968;
  }

  .stats-value-secondary {
    color: #001a33;
  }

  .stats-value-success {
    color: #2e7d32;
  }

  .stats-trend {
    color: #666;
    margin: 0;
    font-size: 0.9rem;
  }

  /* Tabla de estadísticas */
  .stats-table-card {
    margin-bottom: 2rem;
  }

  .stats-section-title {
    color: #001a33;
    font-size: 1.3rem;
    margin: 0 0 1.5rem 0;
    font-weight: 600;
  }

  .stats-table {
    width: 100%;
    border-collapse: collapse;
  }

  .stats-table thead tr {
    background: #f5f5f5;
    border-bottom: 2px solid #ddd;
  }

  .stats-table th {
    padding: 1rem;
    color: #001a33;
    font-weight: 700;
  }

  .stats-table tbody tr {
    border-bottom: 1px solid #eee;
  }

  .stats-table tbody tr:hover {
    background: #fafafa;
  }

  .stats-table td {
    padding: 1rem;
  }

  .stats-product-name {
    color: #001a33;
    font-weight: 600;
  }

  .stats-sales {
    color: #666;
  }

  .stats-revenue {
    color: #a89968;
    font-weight: 700;
  }

  .stats-evolution-up {
    color: #2e7d32;
    font-weight: 600;
  }

  .stats-evolution-down {
    color: #c62828;
    font-weight: 600;
  }

  /* Utilidades de alineación */
  .text-left {
    text-align: left;
  }

  .text-center {
    text-align: center;
  }

  .text-right {
    text-align: right;
  }
</style>
