---
import Layout from '../../layouts/Layout.astro';

export function getStaticPaths() {
  return [
    { params: { slug: 'jamones' } },
    { params: { slug: 'quesos' } },
    { params: { slug: 'embutidos' } }
  ];
}

const { slug } = Astro.params;

const categoryTitles = {
  jamones: { title: 'Jamones Premium', subtitle: 'Nuestros mejores jamones ibéricos' },
  quesos: { title: 'Quesos Artesanales', subtitle: 'Quesos de denominación de origen' },
  embutidos: { title: 'Embutidos Selectos', subtitle: 'Embutidos tradicionales' }
};

const info = categoryTitles[slug] || {
  title: 'Productos',
  subtitle: 'Nuestros productos'
};
---

<Layout>
  <!-- CABECERA -->
  <div style="text-align:center; margin-bottom:4rem; padding:2rem 0;">
    <span style="color:#a89968;font-size:.75rem;font-weight:800;text-transform:uppercase;letter-spacing:3px;
      display:inline-block;padding:.5rem 1.5rem;background:rgba(168,153,104,.08);
      border-radius:50px;margin-bottom:1rem;">
      {slug.toUpperCase()}
    </span>

    <h1 style="font-size:3.5rem;margin:1rem 0 .8rem;color:#001a33;font-weight:800;">
      {info.title}
    </h1>

    <div style="width:80px;height:3px;background:linear-gradient(90deg,#a89968,#d4a574);
      margin:1.5rem auto;border-radius:10px;"></div>

    <p style="opacity:.6;font-size:1.1rem;max-width:700px;margin:1.5rem auto 0;">
      {info.subtitle}
    </p>
  </div>

  <!-- GRID -->
  <div
    id="productosGrid"
    data-categoria={slug}
    style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
    gap:2rem;margin-top:3rem;padding:0 1rem;">
  </div>

  <!-- ESTILOS -->
  <style>
    article {
      background:white;
      border-radius:8px;
      overflow:hidden;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
      transition:.3s;
      display:flex;
      flex-direction:column;
    }

    article:hover {
      box-shadow:0 8px 24px rgba(0,0,0,.15);
      transform:translateY(-4px);
    }

    .product-image-wrapper {
      height:280px;
      overflow:hidden;
      background:#f5f5f5;
    }

    .product-image-wrapper img {
      width:100%;
      height:100%;
      object-fit:cover;
      transition:.3s;
    }

    article:hover img {
      transform:scale(1.05);
    }

    .product-info {
      padding:1.5rem;
      display:flex;
      flex-direction:column;
      flex-grow:1;
    }

    .product-name {
      font-weight:700;
      color:#001a33;
      margin-bottom:.5rem;
    }

    .product-description {
      font-size:.85rem;
      color:#666;
      flex-grow:1;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
    }

    .product-footer {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:auto;
    }

    .product-price {
      font-size:1.3rem;
      font-weight:800;
      color:#d4495a;
    }

    .btn-view {
      padding:.6rem 1.2rem;
      background:linear-gradient(135deg,#667eea,#764ba2);
      color:white;
      border-radius:4px;
      text-decoration:none;
      font-size:.85rem;
    }
  </style>

  <!-- SCRIPT -->
  <script is:inline>
    const categoria = document.getElementById('productosGrid').dataset.categoria;

    async function cargarProductos() {
      try {
        const res = await fetch('/api/admin/productos');
        const data = await res.json();

        const productos = data.productos
          ?.filter(p => p.categorias?.slug === categoria)
          .map(p => `
            <article>
              <div class="product-image-wrapper">
                <img src="${p.imagen_url}" alt="${p.nombre}" loading="lazy" />
              </div>
              <div class="product-info">
                <h3 class="product-name">${p.nombre}</h3>
                <p class="product-description">${p.descripcion || ''}</p>
                <div class="product-footer">
                  <div class="product-price">€${(p.precio_centimos / 100).toFixed(2)}</div>
                  <a href="/productos/${p.id}" class="btn-view">Ver</a>
                </div>
              </div>
            </article>
          `).join('');

        document.getElementById('productosGrid').innerHTML =
          productos || '<p style="opacity:.6;text-align:center;">No hay productos</p>';

      } catch (e) {
        console.error(e);
      }
    }

    cargarProductos();
  </script>
</Layout>