---
import Layout from './Layout.astro';

interface Props {
  requireAuth?: boolean;
  requireAdmin?: boolean;
}

const { requireAuth = false, requireAdmin = false } = Astro.props;
---

<Layout>
  <script>
    const userRole = localStorage.getItem('user_role');
    const authToken = document.cookie.includes('auth_token');
    const currentPath = window.location.pathname;

    // Si es una ruta admin
    if (currentPath.startsWith('/admin')) {
      if (!authToken && userRole !== 'admin') {
        // No está logueado → al login
        window.location.href = '/login?redirect=' + encodeURIComponent(currentPath);
      } else if (userRole !== 'admin') {
        // Está logueado pero no es admin → sin acceso
        window.location.href = '/sin-acceso';
      }
    }
  </script>

  <slot />
</Layout>
